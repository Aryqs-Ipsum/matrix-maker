<!DOCTYPE html>
<html lang="en">

<head>

    <!-- basic meta -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple kpp maker - OMSI 2</title>
    <meta name="description" content="Create colored matrix for omsi 2 and generate hof easily.">

    <!-- app -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="./data/icons/icon-192x192.png">

    <meta name="msapplication-TileImage" content="./data/icons/icon-192x192.png">
    <meta name="msapplication-TileColor" content="#26C6DA">
    
    <link rel="shortcut icon" href="./data/icons/icon-96x96.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#34515E">

    <!-- twitter card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Simple kpp maker - OMSI 2">
    <meta name="twitter:description" content="Create colored matrix for omsi 2 and generate hof easily."></meta>
    <meta name="twitter:creator" content="@ipsumhh">
    <meta name="twitter:image" content="http://kpp.genav.ch/data/illustrations/banner.jpg">

    <!-- open graph -->
    <meta property="og:title" content="Simple kpp maker - OMSI 2" />
    <meta property="og:description" content="Create colored matrix for omsi 2 and generate hof easily." />
    <meta property="og:image" content="http://kpp.genav.ch/data/illustrations/banner.jpg" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/balm-ui@next/dist/balm-ui.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins" rel="stylesheet">
    <link rel="stylesheet" href="data/style.css">
</head>

<body>

    <div id="app">

        <!-- preloader -->
        <div id="preloader">
            <ui-spinner active>loading app ...</ui-spinner>
        </div>

        <!-- share dialog -->
        <ui-dialog v-model="shareDialogOpen">
            <ui-dialog-title>Share current matrix</ui-dialog-title>
            <ui-dialog-content>
                <ui-grid>
                    <ui-grid-cell>
                        <p>Open this link in a new browser to import current matrix.</p>
                        <ui-textfield v-model="shurl">
                            {{ current.name }} matrix link
                            <template #after>
                                <ui-textfield-icon @click.native="copyToClipboard(shurl)">content_copy</ui-textfield-icon>
                            </template>
                        </ui-textfield>
                    </ui-grid-cell>
                    <ui-grid-cell>
                        <img :src="qrurl" alt="qr code">
                    </ui-grid-cell>
                </ui-grid>
            </ui-dialog-content>
            <ui-dialog-actions></ui-dialog-actions>
        </ui-dialog>

        <!-- download hof dialog -->
        <ui-dialog v-model="downloadDialogOpen" :mask-closable="true">
            <ui-dialog-content>
                <section class="illustration">
                    <ui-icon class="purple600">get_app</ui-icon>
                    <h4>Last step</h4>
                    <p>Select a hof name file</p>
                    <img src="./data/illustrations/package.png">
                </section>
                <ui-textfield v-model="hofName">hof name</ui-textfield>
                <ui-button style="float: right;" raised @click="generateHof()">Download</ui-button>
            </ui-dialog-content>
        </ui-dialog>

        <!-- licence infos -->
        <ui-drawer type="modal" :open="licenceDrawerOpen" style="margin-left:255px;">
            <ui-drawer-header>
                <ui-drawer-title>Infos</ui-drawer-title>
                <ui-drawer-subtitle>Attributions</ui-drawer-subtitle>
            </ui-drawer-header>
            <ui-drawer-content>
                <ui-nav>
                    <ui-nav-item href="http://www.freepik.com">
                        <ui-item-first-content>
                            <ui-icon>wallpaper</ui-icon>
                        </ui-item-first-content>
                        <ui-item-text-content>Designed by macrovector / Freepik</ui-item-text-content>
                    </ui-nav-item>
                    <ui-nav-item href="https://fonts.google.com/specimen/Poppins">
                        <ui-item-first-content>
                            <ui-icon>format_size</ui-icon>
                        </ui-item-first-content>
                        <ui-item-text-content>Google fonts</ui-item-text-content>
                    </ui-nav-item>
                    <ui-nav-item href="https://github.com/Aryqs-Ipsum/matrix-maker">
                        <ui-item-first-content>
                            <ui-icon>integration_instructions</ui-icon>
                        </ui-item-first-content>
                        <ui-item-text-content>Open source project</ui-item-text-content>
                    </ui-nav-item>
                    <ui-nav-item href="https://kpp.genav.ch/discord">
                        <ui-item-first-content>
                            <ui-icon>quickreply</ui-icon>
                        </ui-item-first-content>
                        <ui-item-text-content>Discord server</ui-item-text-content>
                    </ui-nav-item>
                    <ui-nav-item href="https://www.instagram.com/_genav/">
                        <ui-item-first-content>
                            <ui-icon>camera_enhance</ui-icon>
                        </ui-item-first-content>
                        <ui-item-text-content>Instagram</ui-item-text-content>
                    </ui-nav-item>
                </ui-nav>
                <div style="padding:8px">
                    <p>Site develloped by Adam Mathieson and Arno Cellarier. Fonts copyright their respective owners</p>
                    <small>v2.0a</small>
                </div>
            </ui-drawer-content>
        </ui-drawer>
        <ui-drawer-backdrop style="margin-left:255px;"></ui-drawer-backdrop>

        <!-- mobile disclaimer -->
        <section v-show="isMobile" class="empty-state">
            <ui-icon>desktop_access_disabled</ui-icon>
            <p>Your screen is too small, please open app in new device or zoom out.</p>
        </section>

        <div class="demo-container" v-show="!isMobile">
            <!-- App bar -->
            <ui-top-app-bar v-shadow="4" class="demo-app-bar" content-selector=".demo-content" :nav-icon="false">
                Kpp Maker
                <template #toolbar="{ toolbarItemClass }">
                    <ui-icon-button :class="toolbarItemClass" v-tooltip="'Save all destinations in device storage'" aria-describedby="save in storage" icon="save" @click="saveDestsInLocalStorage()"></ui-icon-button>
                    
                    <div class="menu-content">
                        <ui-icon-button :class="toolbarItemClass" icon="get_app" @click="$balmUI.onOpen('downloadMenu')"></ui-icon-button>
                        <ui-menu-anchor absolute>
                            <ui-menu
                            @selected="onSelected"
                            v-model="downloadMenu"
                            :items="[
                                'Current matrix',
                                'Create hof with destinations'
                            ]"
                            ></ui-menu>
                        </ui-menu-anchor>
                    </div>
                </template>
            </ui-top-app-bar>
            <!-- Content -->
            <div class="demo-content">
                <!-- Drawer -->
                <ui-drawer viewport-height>
                    <ui-drawer-header v-show="current.code">
                        <canvas width="256" height="64" style="border: solid 1px black;margin-left:-18px;" id="canvas"></canvas>
                        <ui-drawer-title>{{ current.name }}</ui-drawer-title>
                        <ui-drawer-subtitle>{{ current.code }}</ui-drawer-subtitle>
                    </ui-drawer-header>
                    <ui-drawer-content>
                        <ui-nav>
                            <ui-nav-item href="#" id="destsList" v-for="(dest, index) in dests" :key="index" @click="selectCurrent(index)" :active="index == current.index">
                                <ui-item-first-content>
                                    <ui-icon v-bind:style="{ color: dest.line.back }">flag</ui-icon>
                                </ui-item-first-content>
                                <ui-item-text-content>{{dest.code}} <ui-icon class="align">arrow_forward</ui-icon> {{dest.name}}</ui-item-text-content>
                            </ui-nav-item>
                            <ui-nav-item href="https://forms.gle/yax9W7PoiHCeBKH18" target="_blank">
                                <ui-item-first-content>
                                    <ui-icon>feedback</ui-icon>
                                </ui-item-first-content>
                                <ui-item-text-content>Bug report</ui-item-text-content>
                            </ui-nav-item>
                            <ui-textfield style="width:239px;height:48px;margin-left:8px;" input-type="number" v-model="addDestCode" v-on:keyup.enter="addDest(addDestCode)" id="add-dest">
                                add dest
                                <template #before>
                                    <ui-textfield-icon>create</ui-textfield-icon>
                                </template>
                            </ui-textfield>
                        </ui-nav>
                        <ui-icon-button v-tooltip="'Terms and attributions'" aria-describedby="details" style="position:absolute;bottom:8px;left:8px" @click="licenceDrawerOpen=!licenceDrawerOpen" :icon="licenceDrawerOpen ? 'close' : 'info'"></ui-icon-button>
                    </ui-drawer-content>
                </ui-drawer>
                <!-- App content -->
                <div class="demo-app-content">

                    <!-- hof data -->
                    <section v-shadow="2" v-show="current.code" class="hof-data">
                        <ui-textfield outlined v-model="current.code" input-type="number" style="width:7rem;height:48px;" disabled>code</ui-textfield>
                        <ui-textfield outlined v-model="current.name" style="height:48px;" required>dest</ui-textfield>
                        <div class="hof-data-btn-section">
                            <ui-icon-button v-tooltip="'Share actual destination with qrcode'" aria-describedby="share" icon="share" @click="shareCurrent()"></ui-icon-button>
                            <ui-icon-button v-tooltip="'Delete actual destination'" aria-describedby="delete" icon="delete" @click="deleteDest()"></ui-icon-button>
                            <ui-icon-button v-tooltip="'Refresh matrix'" aria-describedby="refresh" icon="refresh" @click="refreshMatrix()" id="btn-spinning"></ui-icon-button>
                            <ui-icon-button v-tooltip="'Advanced settings'" aria-describedby="settings" icon="settings" @click="$balmUI.onOpen('destSettingsDialogOpen')"></ui-icon-button>
                        </div>
                        <ui-button @click="$balmUI.onOpen('iconDialogOpen')" outlined style="float:right;margin-top:4px;">icon options</ui-button>
                    </section>

                    <!-- Edit current matrix section -->
                    <section v-show="current.code" class="main-content">

                        <!-- dest settings dialog -->
                        <ui-dialog v-model="destSettingsDialogOpen" :mask-closable="true">
                            <ui-dialog-title>Settings for {{ current.code }}</ui-dialog-title>
                            <ui-dialog-content>
                                <small>unique id : {{current.index}}</small><br>
                                <ui-list>
                                    <ui-item>
                                        <ui-item-first-content>
                                            <ui-icon>label_off</ui-icon>
                                        </ui-item-first-content>
                                        <ui-item-text-content>Show line on front</ui-item-text-content>
                                        <ui-item-last-content>
                                            <ui-switch v-model="current.front.line" @change="refreshMatrix()"></ui-switch>
                                        </ui-item-last-content>
                                    </ui-item>
                                    <ui-item>
                                        <ui-item-first-content>
                                            <ui-icon>save</ui-icon>
                                        </ui-item-first-content>
                                        <ui-item-text-content>Auto-save</ui-item-text-content>
                                        <ui-item-last-content>
                                            <ui-switch v-model="autosave" @change="autosavePersist()"></ui-switch>
                                        </ui-item-last-content>
                                    </ui-item>
                                </ui-list>
                                <p>Edit dest code</p>
                                <ui-textfield outlined v-model="current.code" input-type="number" style="width:7rem;">code</ui-textfield>
                                <br><small>Caution: do not delete the code entirely</small>
                            </ui-dialog-content>
                            <ui-dialog-actions></ui-dialog-actions>
                        </ui-dialog>

                        <!-- preview canvas -->
                        <img src="data/overlayImage.png" id="overlayImage" style="display: none;">

                        <div class="canvasBox">
                            <div @click="$balmUI.onOpen('lineDialogOpen')" v-tooltip="'Line options'" aria-describedby="line" class="matrixOver" id="lineOver" v-show="current.front.line"></div>
                            <div @click="$balmUI.onOpen('lineDialogOpen')" v-tooltip="'Line options'" aria-describedby="lineAlt" class="matrixOver" id="lineOverAlt" v-show="!current.front.line"></div>
                            <div @click="$balmUI.onOpen('frontDialogOpen')" v-tooltip="'Front text options'" aria-describedby="front" class="matrixOver" id="frontOver" v-show="current.front.line"></div>
                            <div @click="$balmUI.onOpen('frontDialogOpen')" v-tooltip="'Front text options'" aria-describedby="frontAlt" class="matrixOver" id="frontOverAlt" v-show="!current.front.line"></div>
                            <div @click="$balmUI.onOpen('sideDialogOpen')" v-tooltip="'Side text options'" aria-describedby="side" class="matrixOver" id="sideOver"></div>
                            <canvas width="1024" height="256" style="border: solid 1px black;" id="previewCanvas"></canvas>
                        </div>

                        <small>You can edit differents parts of the matrix by clicking on it.</small>
                        
                        <!-- Front text -->
                        <ui-dialog v-model="frontDialogOpen" :mask-closable="true">
                            <ui-dialog-title>Front text options</ui-dialog-title>
                            <ui-dialog-content>
                                <template v-if="current.front.text">
                                    <h4>Fonts</h4>
                                    <ui-select v-model="current.front.font" :options="fontList" @change="loadFont(current.front.font)" id="fontSelector">{{ current.front.text.includes('\n') ? 'Top' : 'Main' }} font</ui-select>
                                    <ui-select v-model="current.front.fontb" :options="fontList" @change="loadFont(current.front.font)" id="fontSelector" v-show="current.front.text.includes('\n')">Bottom font</ui-select>
                                </template>
                                <hr><h4>Text edition</h4>
                                <ui-textfield maxlength="150" v-model="current.front.text" id="frontText" input-type="textarea" rows="2" cols="40" @keyup="refreshMatrix()" @change="saveCurrentIntoDests()">front text</ui-textfield>
                                <div style="position:relative; display:inline-block">
                                    <ui-button raised type="button" v-bind:style="{ backgroundColor: current.front.color, color: pickerTextColor(current.front.color) }">front text color</ui-button raised>
                                    <input type="color" v-model="current.front.color" @change="refreshMatrix()" style="opacity:0; position:absolute; left:0;top:0;width:100%"/>
                                </div>
                            </ui-dialog-content>
                            <ui-dialog-actions></ui-dialog-actions>
                        </ui-dialog>

                        <!-- Line -->
                        <ui-dialog v-model="lineDialogOpen" :mask-closable="true">
                            <ui-dialog-title>Line options</ui-dialog-title>
                            <ui-dialog-content>
                                <section>
                                    <h4>Font</h4>
                                    <ui-select v-model="current.line.font" :options="fontList" @change="loadFont(current.line.font)" id="fontSelector"></ui-select>
                                </section>
                                <hr><h4>Text edition</h4>
                                <section>
                                    <ui-textfield v-model="current.line.text" @keyup="refreshMatrix()">front line number</ui-textfield>
                                    <br>
                                    <div style="position:relative; display:inline-block">
                                        <ui-button raised type="button" v-bind:style="{ backgroundColor: current.line.fore, color: pickerTextColor(current.line.fore) }">line color</ui-button raised>
                                        <input type="color" v-model="current.line.fore" @change="refreshMatrix()" style="opacity:0; position:absolute; left:0;top:0;width:100%"/>
                                    </div>
                                    <div style="position:relative; display:inline-block">
                                        <ui-button raised type="button" v-bind:style="{ backgroundColor: current.line.outl, color: pickerTextColor(current.line.outl) }">line outline</ui-button raised>
                                        <input type="color" v-model="current.line.outl" @change="refreshMatrix()" style="opacity:0; position:absolute; left:0;top:0;width:100%"/>
                                    </div>
                                    <div style="position:relative; display:inline-block">
                                        <ui-button raised type="button" v-bind:style="{ backgroundColor: current.line.back, color: pickerTextColor(current.line.back) }">line background</ui-button raised>
                                        <input type="color" v-model="current.line.back" @change="refreshMatrix()" style="opacity:0; position:absolute; left:0;top:0;width:100%"/>
                                    </div>
                                </section>
                            </ui-dialog-content>
                            <ui-dialog-actions></ui-dialog-actions>
                        </ui-dialog>

                        <!-- Side text -->
                        <ui-dialog v-model="sideDialogOpen" :mask-closable="true">
                            <ui-dialog-title>Side text options</ui-dialog-title>
                            <ui-dialog-content>
                                <template v-if="current.side.text">
                                    <h4>Fonts</h4>
                                    <ui-select v-model="current.side.font" :options="fontList" @change="loadFont(current.side.font)" id="fontSelector">{{ current.side.text.includes('\n') ? 'Top' : 'Main' }} font</ui-select>
                                    <ui-select v-model="current.side.fontb" :options="fontList" @change="loadFont(current.side.font)" id="fontSelector" v-show="current.side.text.includes('\n')">Bottom font</ui-select>
                                </template>
                                <hr><h4>Text edition</h4>
                                <ui-textfield maxlength="150" v-model="current.side.text" id="frontText" input-type="textarea" rows="2" cols="40" @keyup="refreshMatrix()" @change="saveCurrentIntoDests()">front text</ui-textfield>
                                <div style="position:relative; display:inline-block">
                                    <ui-button raised type="button" v-bind:style="{ backgroundColor: current.side.color, color: pickerTextColor(current.side.color) }">side text color</ui-button raised>
                                    <input type="color" v-model="current.side.color" @change="refreshMatrix()" style="opacity:0; position:absolute; left:0;top:0;width:100%"/>
                                </div>
                            </ui-dialog-content>
                            <ui-dialog-actions></ui-dialog-actions>
                        </ui-dialog>

                        <!-- icons options -->
                        <ui-dialog v-model="iconDialogOpen" :mask-closable="true">
                            <ui-dialog-title>Icon options</ui-dialog-title>
                            <ui-dialog-content>
                                <ui-grid style="padding:0">
                                    <ui-grid-cell columns="6">
                                        <ui-select v-model="current.front.iconUrlL" :options="iconList" @change="refreshMatrix()">Front left icon</ui-select><img :src="current.front.iconUrlL" alt="">
                                        <ui-select v-model="current.side.iconUrlL" :options="iconList" @change="refreshMatrix()">Side left icon</ui-select><img :src="current.side.iconUrlL" alt="">
                                    </ui-grid-cell>
                                    <ui-grid-cell columns="6">
                                        <ui-select v-model="current.front.iconUrlR" :options="iconList" @change="refreshMatrix()">Front right icon</ui-select><img :src="current.front.iconUrlR" alt="">
                                        <ui-select v-model="current.side.iconUrlR" :options="iconList" @change="refreshMatrix()">Side right icon</ui-select><img :src="current.side.iconUrlR" alt="">
                                    </ui-grid-cell>
                                </ui-grid>
                                <br>
                                <div style="position:relative; display:inline-block">
                                    <ui-button raised type="button" v-bind:style="{ backgroundColor: current.front.iconHex, color: pickerTextColor(current.front.iconHex) }">Front icon color</ui-button raised>
                                    <input type="color" v-model="current.front.iconHex" @change="refreshMatrix()" style="opacity:0; position:absolute; left:0;top:0;width:100%"/>
                                </div>
                                <br>
                                <div style="position:relative; display:inline-block">
                                    <ui-button raised type="button" v-bind:style="{ backgroundColor: current.side.iconHex, color: pickerTextColor(current.side.iconHex) }">Side icon color</ui-button raised>
                                    <input type="color" v-model="current.side.iconHex" @change="refreshMatrix()" style="opacity:0; position:absolute; left:0;top:0;width:100%"/>
                                </div>
                                <ui-collapse with-icon ripple>
                                    <template #toggle>
                                      <div>Advanced options</div>
                                    </template>
                                    <div>
                                        <p style="margin-bottom:0;">Add customs icons.</p>
                                        <small>Must be black and white .png with 32px height and 29px width.</small>
                                        <br>
                                        <input type="file" id="frontIconInputL" @change="iconSubmitted">Front left icon</input>
                                        <input type="file" id="frontIconInputR" @change="iconSubmitted">Front right icon</input>
                                        <input type="file" id="sideIconInputL" @change="iconSubmitted">Side left icon</input>
                                        <input type="file" id="sideIconInputR" @change="iconSubmitted">Side right icon</input>
                                        <br><canvas id="iconLoader" width="32" height="32" style="width:32px;height:32px;"></canvas>
                                    </div>
                                </ui-collapse>
                                </ui-dialog-content>
                            <ui-dialog-actions></ui-dialog-actions>
                        </ui-dialog>

                    </section>

                    <!-- Empty selection section -->
                    <section v-show="!current.code" class="empty-state">
                        <ui-icon>touch_app</ui-icon>
                        <p>Start by select a destination ou create it in the side nav.</p>
                        <ui-button raised @click="addDestFocus()">add destination</ui-button>
                    </section>

                </div>
            </div>
        </div>
    </div>

    <!-- scripts -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/balm-ui@8.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/balm-ui@8.0.0/dist/balm-ui-plus.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas2image@1.0.5/canvas2image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.5.0/jszip.min.js"></script>
    <script src="./data/ascii-table.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jcanvas/21.0.1/min/jcanvas.min.js"></script>
    <script type="text/javascript">
        var _c = new Date().getTime();
        document.write('<script type="text/javascript" src="data/script.js?c='+_c+'"><\/script>');
    </script>

</body>

</html>